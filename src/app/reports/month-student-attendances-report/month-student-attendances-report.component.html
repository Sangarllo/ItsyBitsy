<mat-card *ngIf="students$ | async as students; else loading">

    <mat-toolbar color="primary">
        <span>{{pageTitle}}</span>
        <span class="fill-remaining-space"></span>

        <div *ngIf="showReportFilters; else hideStudentList">

            <mat-form-field class="filter-form-field filter-year" *ngIf="YEARS">
                <mat-label>Escoge un año</mat-label>
                <mat-select [(ngModel)]="selectedYear">
                    <mat-option *ngFor="let year of YEARS" [value]="year">
                        {{year}}
                    </mat-option>
                </mat-select>
            </mat-form-field>

            <mat-form-field class="filter-form-field filter-month" *ngIf="MONTHS">
                <mat-label>Escoge un mes</mat-label>
                <mat-select [(ngModel)]="selectedMonth.int">
                    <mat-option *ngFor="let month of MONTHS" [value]="month.int">
                        {{month.name}}
                    </mat-option>
                </mat-select>
            </mat-form-field>

            <mat-form-field class="filter-form-field filter-student">
                <mat-label>Escoge un estudiante</mat-label>
                <mat-select [(ngModel)]="selectedStudent">
                    <mat-option *ngFor="let student of students" [value]="student">
                        {{student.displayName}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            &nbsp;&nbsp;
            <button mat-raised-button color="accent" [disabled]="!selectedStudent" (click)="getReport()">Crear Informe</button>
        </div>
    </mat-toolbar>

    <div class="container summary" *ngIf="student">
        <div class="row">

            <div class="col-4 text-left">
                <img [src]="student.photoURL" [alt]="student.displayName" class="img-thumbnail">
                <div class="data-summary">
                    <h6>Asistencias de {{student.displayName}}</h6>
                    <h6>{{infoReport}}</h6>
                </div>
            </div>

            <div class="col-4 text-left">
                <img [src]="'assets/section/curso.png'" class="img-thumbnail" />
                <div class="data-summary">
                    <h6>{{infoCourses}}</h6>
                    <h6>{{infoLessons}}</h6>
                </div>
            </div>

            <div class="col-4 text-left">
                <img [src]="'assets/section/rate.png'" class="img-thumbnail" />
                <div class="data-summary">
                    <h6>Tarifa aplicada: {{infoRate}}</h6>
                    <h6>Total a cobrar: {{infoPayment}}</h6>
                </div>
            </div>

        </div>
    </div>

    <div id="report-errors" class="alert alert-danger" role="alert" *ngIf="reportErrors?.length > 0">
        <h4 class="alert-heading">Errores en el informe</h4>
        <p>Se ha detectado algún error en la generación del informe o en la información asociada al estudiante que deberás corregir para conseguir un informe adecuado.</p>
        <hr>
        <p *ngFor="let error of reportErrors">
            - {{ error }}
        </p>
    </div>

    <sh-user-attendance-table *ngIf="student; else noReport" [student]="student" [dateIni]="dateIni" [dateEnd]="dateEnd" (reportSummary)="reportSummary($event)"></sh-user-attendance-table>

</mat-card>

<ng-template #noReport>
    <br>
    <div class="alert alert-danger text-center" role="alert">
        Selecciona un estudiante para generar el informe asociado
        <br/>
    </div>
</ng-template>

<ng-template #hideStudentList>
    <button mat-raised-button color="accent" (click)="showList()">Otro Informe</button>
</ng-template>


<ng-template #loading>
    <div class="container-spinner">
        <mat-spinner></mat-spinner>
    </div>
</ng-template>